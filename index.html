<!DOCTYPE html>
<html>
<head>
    <title>Venetian Trade Routes Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        #map { height: 100vh; width: 100%; }
        .popup-content {
            font-family: 'Arial', sans-serif;
            font-size: 14px;
        }
        .popup-content button {
            margin-top: 5px;
            padding: 4px 8px;
            background-color: #DABC38; /* Purple */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .popup-content button:hover {
            background-color: #574EA0; /* Darker purple on hover */
        }
    </style>
</head>
<body>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize the map centered on Venice
    var map = L.map('map').setView([45.4408, 12.3155], 7);

    // Base map layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Layer groups
    var venetianLayer = L.layerGroup();
    var byzantineLayer = L.layerGroup();
    var tradeRoutesLayer = L.layerGroup();

    // Venetian Republic Polygon
    var venetianPolygon = L.polygon([
        [46, 12], [45, 13], [43, 14], [41, 13], [42, 12]
    ], {color: 'blue', fillOpacity: 0.2}).bindPopup("<div class='story-popup'><strong>Venetian Republic</strong><br>At its height, Venice was a hub of trade and art. Ships sailed across the Mediterranean, bringing treasures, mosaics, and relics to enrich St. Mark’s Basilica.</div>");
    venetianLayer.addLayer(venetianPolygon);

    // Byzantine Empire Polygon
    var byzantinePolygon = L.polygon([
        [43, 26], [42, 28], [41, 29], [40, 27], [41, 26]
    ], {color: 'purple', fillOpacity: 0.2}).bindPopup("Byzantine Empire around 1200 AD");
    byzantineLayer.addLayer(byzantinePolygon);

    // Pins
    var venice = L.marker([45.4408, 12.3155]).bindPopup("<b>Venice</b><br>The Queen of the Adriatic, hub of merchants and faith. Treasures and relics flowed to St. Mark’s.");
    var constantinople = L.marker([41.0082, 28.9784]).bindPopup("<b>Constantinople</b><br>The gateway to the East. After 1204, many mosaics, relics, and the Horses of St. Mark arrived here.");
    var crete = L.marker([35.3387, 25.1442]).bindPopup("<b>Crete</b><br>Venice’s prized colony — source of food, wine, and culture.");
    var alexandria = L.marker([31.2001, 29.9187]).bindPopup("<b>Alexandria</b><br>Where St. Mark's relics began their journey to Venice.");

    venetianLayer.addLayer(venice);
    venetianLayer.addLayer(constantinople);
    venetianLayer.addLayer(crete);
    venetianLayer.addLayer(alexandria);

    // Trade routes
    var route1 = L.polyline([[45.4408, 12.3155],[41.0082, 28.9784]], {color:'orange'}).bindPopup("Trade route: Venice → Constantinople");
    var route2 = L.polyline([[45.4408, 12.3155],[35.3387, 25.1442]], {color:'orange'}).bindPopup("Trade route: Venice → Crete");
    var route3 = L.polyline([[35.3387, 25.1442],[31.2001, 29.9187]], {color:'orange'}).bindPopup("Trade route: Crete → Alexandria");
    tradeRoutesLayer.addLayer(route1);
    tradeRoutesLayer.addLayer(route2);
    tradeRoutesLayer.addLayer(route3);

    // Add default layers
    venetianLayer.addTo(map);
    byzantineLayer.addTo(map);
    tradeRoutesLayer.addTo(map);

    // Layer control
    L.control.layers(null, {
        "Venetian Republic": venetianLayer,
        "Byzantine Empire": byzantineLayer,
        "Trade Routes": tradeRoutesLayer
    }).addTo(map);

    // Story popups
    var storySteps = [
        {
            coords: [45.4408, 12.3155],
            content: "<div class='popup-content'><strong>Ready to explore Venetian trading routes?</strong><br>Step into a world of adventure, faith, and ambition—where spices, silks, and sacred relics sailed from Alexandria and Constantinople to Venice. Follow their journeys and discover how the city became a treasure trove of history.<br><button onclick='nextPopup()'>Next</button></div>"
        },
        {
            coords: [31.2001, 29.9187],
            content: "<div class='popup-content'><b>Alexandria → Venice (828)</b><br>Picture this: two Venetian merchants sneaking into Alexandria with a crate… but instead of fruit or silk, they’re smuggling Saint Mark’s relics. Legend says they hid them under pork to sneak past guards! Thanks to them, Venice got its most famous saint—and a story that still fills the Basilica with awe.<br><button onclick='nextPopup()'>Next</button></div>"
        },
        {
            coords: [41.0082, 28.9784],
            content: "<div class='popup-content'><b>Constantinople → Venice (1204)</b><br>Fast forward a few centuries: Venice joins the Fourth Crusade, and suddenly the city is raining treasures. Golden icons, mosaics, and marble columns make the long trip from Constantinople to Venice. It’s like Venice got the ultimate medieval IKEA delivery—only instead of furniture, it’s priceless relics and sparkling Byzantine art.<br><button onclick='nextPopup()'>Next</button></div>"
        },
        {
            coords: [45.4408, 12.3155],
            content: "<div class='popup-content'><b>Venice → Today</b><br>The relics made it—and boy, did Venice roll out the red carpet. Golden mosaics, sparkling icons, and jeweled altars turn St. Mark’s into a treasure chest you can actually walk through. Every column and glittering piece whispers stories of sneaky merchants, daring crusades, and centuries of Venetian flair.<br><button onclick='nextPopup()'>End</button></div>"
        }
    ];

    var currentStep = 0;
    var currentPopup;

    function nextPopup() {
        if(currentPopup) {
            map.closePopup(currentPopup);
        }

        if(currentStep < storySteps.length) {
            var step = storySteps[currentStep];

            // Smooth pan and zoom
            map.flyTo(step.coords, 7, {
                animate: true,
                duration: 2
            });

            // Show popup after fly animation
            setTimeout(function() {
                currentPopup = L.popup({maxWidth: 300})
                    .setLatLng(step.coords)
                    .setContent(step.content)
                    .openOn(map);
            }, 2000);

            currentStep++;
        }
    }

    // Start the story at Venice
    window.onload = function() {
        nextPopup();
    };
</script>
</body>
</html>
