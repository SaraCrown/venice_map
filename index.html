<!DOCTYPE html>
<html>
<head>
    <title>Venetian Trade Routes Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        #map { height: 100vh; width: 100%; }
        .popup-content {
            font-family: 'Arial', sans-serif;
            font-size: 14px;
        }
        .popup-content button {
            margin-top: 5px;
            padding: 4px 8px;
            background-color: #DABC38; /* Purple */
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .popup-content button:hover {
            background-color: #574EA0; /* Darker purple on hover */
        }
    </style>
</head>
<body>
<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Initialize the map centered on Venice
    var map = L.map('map').setView([45.4408, 12.3155], 7);

    // Base map layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Layer groups
    var venetianLayer = L.layerGroup();
    var byzantineLayer = L.layerGroup();
    var tradeRoutesLayer = L.layerGroup();

    // Venetian Republic Polygon
   var venetianPolygon = L.polygon([
      [46, 12], [45, 13], [43, 14], [41, 13], [42, 12]
    ], {color: 'blue', fillOpacity: 0.2}).bindPopup("<div class='story-popup'><strong>Venetian Republic (c. 1300–1500)</strong><br>At its height, Venice was a hub of trade and art, with ships sailing across the Mediterranean carrying treasures, mosaics, and relics to St. Mark’s Basilica. What began as a small lagoon city grew into a maritime powerhouse, controlling the Adriatic and stretching into today’s Italy, Greece, Crete, and Cyprus. Venice didn’t just trade—it shaped the Mediterranean.</div>");
    venetianLayer.addLayer(venetianPolygon);

    // Byzantine Empire Polygon
    var byzantinePolygon = L.polygon([
        [42.5, 19.0], // Northern Greece (Macedonia)
    [41.0, 21.0], // Central Greece
    [39.5, 22.0], // Southern Greece
    [37.5, 23.0], // Aegean coast
    [36.0, 25.0], // Southwestern Anatolia
    [37.0, 30.0], // Central Anatolia
    [39.0, 33.0], // Eastern Anatolia
    [41.0, 29.0], // Constantinople / Istanbul
    [42.5, 19.0]  // back to start
    ], {color: 'purple', fillOpacity: 0.2}).bindPopup("<div class='story-popup'><strong>Byzantine Empire (c. 1200)</strong><br>The Byzantine Empire ruled the Eastern Mediterranean and the Balkans, linking Europe and Asia through trade, armies, and ideas. Merchants, diplomats, and adventurers flocked to the city, and many of its treasures—icons, mosaics, and marble columns—soon sailed to Venice, inspiring its art, faith, and ambition. Today these lands are Turkey, Greece, and Bulgaria, but in 1200, Byzantium set the gold standard for wealth, power, and legendary style.</div>");
    byzantineLayer.addLayer(byzantinePolygon);

    // Pins
    var venice = L.marker([45.4408, 12.3155]).bindPopup("<b>Venice</b><br>The Queen of the Adriatic, hub of merchants and faith. Treasures and relics flowed to St. Mark’s.");
    var constantinople = L.marker([41.0082, 28.9784]).bindPopup("<b>Constantinople</b><br>The gateway to the East. After 1204, many mosaics, relics, and the Horses of St. Mark arrived here.");
    var crete = L.marker([35.3387, 25.1442]).bindPopup("<b>Crete</b><br>Venice’s prized colony — source of food, wine, and culture.");
    var alexandria = L.marker([31.2001, 29.9187]).bindPopup("<b>Alexandria</b><br>Where St. Mark's relics began their journey to Venice.");
    var corfu = L.marker([39.6243, 19.9217]).bindPopup("<b>Corfu</b><br>Venice’s first foothold in the Ionian Sea—fortress island and key supply stop.");
    var cyprus = L.marker([35.1856, 33.3823]).bindPopup("<b>Cyprus</b><br>Linked Venice to Levantine trade routes, supplying sugar, timber, and spices.");
    var ragusa = L.marker([42.6507, 18.0944]).bindPopup("<b>Ragusa (Dubrovnik)</b><br>This city thrived as a trading republic in Venice’s shadow. Grain, salt, and Balkan silver passed through its walls.");
    var modon = L.marker([36.8186, 21.7046]).bindPopup("<b>Modon</b><br>‘The Eye of the Republic,’ Venice’s fortress guarding the route to Alexandria and Constantinople.");
    var negroponte = L.marker([38.4634, 23.6025]).bindPopup("<b>Negroponte (Chalkis)</b><br>Venice’s gateway to the Aegean, guarded the sea lanes toward Constantinople and the Black Sea.");
    var antioch = L.marker([36.2021, 36.1600]).bindPopup("<b>Antioch</b><br>A key Levantine port where Eastern spices and silks flowed into Venetian hands, fueling wealth across the Mediterranean.");
    var trebizond = L.marker([41.0053, 39.7220]).bindPopup("<b>Trebizond</b><br>Trebizond, the last Byzantine outpost on the Silk Road, funneled silks and spices from Asia into Venetian markets.");

    venetianLayer.addLayer(venice);
    venetianLayer.addLayer(constantinople);
    venetianLayer.addLayer(crete);
    venetianLayer.addLayer(alexandria);
    venetianLayer.addLayer(corfu);
    venetianLayer.addLayer(cyprus);
    venetianLayer.addLayer(ragusa);
    venetianLayer.addLayer(modon);
    venetianLayer.addLayer(negroponte);
    venetianLayer.addLayer(antioch);
    venetianLayer.addLayer(trebizond);

    // Trade routes
    var route1 = L.polyline([[45.4408, 12.3155],[41.0082, 28.9784]], {color:'orange'}).bindPopup("Trade route: Venice → Constantinople");
    var route2 = L.polyline([[45.4408, 12.3155],[35.3387, 25.1442]], {color:'orange'}).bindPopup("Trade route: Venice → Crete");
    var route3 = L.polyline([[35.3387, 25.1442],[31.2001, 29.9187]], {color:'orange'}).bindPopup("Trade route: Crete → Alexandria");
    tradeRoutesLayer.addLayer(route1);
    tradeRoutesLayer.addLayer(route2);
    tradeRoutesLayer.addLayer(route3);

    // Add default layers
    venetianLayer.addTo(map);
    byzantineLayer.addTo(map);
    tradeRoutesLayer.addTo(map);

    // Layer control
    L.control.layers(null, {
        "Venetian Republic": venetianLayer,
        "Byzantine Empire": byzantineLayer,
        "Trade Routes": tradeRoutesLayer
    }).addTo(map);

    // Story popups
var storySteps = [
    {
        coords: [45.4408, 12.3155],
        content: `<div class='popup-content'>
                    <b>Ready to explore Venetian trading routes?</b><br>
                    Step into a world of adventure, faith, and ambition—where spices, silks, and sacred relics sailed from Alexandria and Constantinople to Venice. Follow their journeys and discover how the city became a treasure trove of history.<br>
                    <div class='popup-buttons'>
                        <button onclick='nextPopup()'>Next</button>
                        <button onclick='toggleSpeech(this)'>Play</button>
                    </div>
                  </div>`
    },
    {
        coords: [45.4408, 12.3155],
        content: `<div class='popup-content'>
                    <b>Building an Empire</b><br>
                    In the 14th and 15th centuries, Venice ruled the waves. Stretching along the Adriatic and reaching into Greece, Crete, and Cyprus, Venice wasn’t just a city—it was a maritime powerhouse. Palaces, ports, and fleets dotted the Mediterranean, and every canal in Venice hummed with trade, diplomacy, and intrigue.<br>
                    <div class='popup-buttons'>
                        <button onclick='nextPopup()'>Next</button>
                        <button onclick='toggleSpeech(this)'>Play</button>
                    </div>
                  </div>`
    },
    {
        coords: [31.2001, 29.9187],
        content: `<div class='popup-content'>
                    <b>Key Trade Routes to the East</b><br>
                    Spices, silks, and rare papyrus sailed from Alexandria’s bustling ports to Venice. Aromatic cinnamon, vibrant dyes, and delicate textiles carried tales of distant lands—and made Venetian markets sparkle with the exotic. Every crate tells a story of adventure, trade, and discovery.<br>
                    <div class='popup-buttons'>
                        <button onclick='nextPopup()'>Next</button>
                        <button onclick='toggleSpeech(this)'>Play</button>
                    </div>
                  </div>`
    },
    {
        coords: [41.0082, 28.9784],
        content: `<div class='popup-content'>
                    <b>The City of Treasures</b><br>
                    Fast forward a few centuries: Venice joins the Fourth Crusade, and suddenly the city is raining treasures. Golden icons, mosaics, and marble columns make the long trip from Constantinople to Venice. It’s like Venice got the ultimate medieval IKEA delivery—only instead of furniture, it’s priceless relics and sparkling Byzantine art.<br>
                    <div class='popup-buttons'>
                        <button onclick='nextPopup()'>Next</button>
                        <button onclick='toggleSpeech(this)'>Play</button>
                    </div>
                  </div>`
    },
    {
        coords: [45.4408, 12.3155],
        content: `<div class='popup-content'>
                    <b>Where Treasures Landed</b><br>
                    The journey ends here, in the canals of Venice. Relics, spices, silks, and art transformed the city into a hub of wealth, faith, and culture. St. Mark’s Basilica glitters with Byzantine icons and mosaics, each a testament to the daring voyages and bold ambition that made Venice the “Queen of the Adriatic“.<br>
                    <div class='popup-buttons'>
                        <button onclick='nextPopup()'>End</button>
                        <button onclick='toggleSpeech(this)'>Play</button>
                    </div>
                  </div>`
    }
];

    var currentStep = 0;
    var currentPopup;

    function nextPopup() {
        if(currentPopup) {
            map.closePopup(currentPopup);
        }

        if(currentStep < storySteps.length) {
            var step = storySteps[currentStep];

            // Smooth pan and zoom
            map.flyTo(step.coords, 7, {
                animate: true,
                duration: 2
            });

            // Show popup after fly animation
            setTimeout(function() {
                currentPopup = L.popup({maxWidth: 300})
                    .setLatLng(step.coords)
                    .setContent(step.content)
                    .openOn(map);
            }, 2000);

            currentStep++;
        }
    }
// Text-to-speech control
var currentUtterance = null;

function toggleSpeech(button) {
    if (currentUtterance && window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
        button.textContent = "Play";
        currentUtterance = null;
    } else {
        var popupContent = button.closest('.popup-content').innerText
            .replace("Play","")
            .replace("Next","")
            .replace("End","")
            .trim();

        currentUtterance = new SpeechSynthesisUtterance(popupContent);

        // Pick a good voice (Google voices tend to be smoother if available)
        if (voices.length > 0) {
            currentUtterance.voice = voices.find(v => v.lang === "en-US" && v.name.includes("Google")) 
                                  || voices[0];
        }

        // Adjust delivery
        currentUtterance.rate = 0.95;   // slower pace
        currentUtterance.pitch = 1.05;  // slight pitch variation
        currentUtterance.volume = 1;

        window.speechSynthesis.speak(currentUtterance);
        button.textContent = "Pause";

        currentUtterance.onend = function() {
            button.textContent = "Play";
            currentUtterance = null;
        };
    }
}
    
    // Start the story at Venice
    window.onload = function() {
        nextPopup();
    };
</script>
</body>
</html>
